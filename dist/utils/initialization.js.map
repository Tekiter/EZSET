{"version":3,"sources":["../../src/utils/initialization.js"],"names":["initialization","createSuperAdmin","exists","User","findOne","where","equals","console","log","remove","admin","username","password","info","realname","roles","result","save","createDefaultPenalty","existLateConfig","PenaltyConfig","count","Late","key","value","existAbsenceConfig","Absence","initialize","isFirstStart","role","loadRoles","module","exports","default"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMA,iBAAiB;AACnB,UAAMC,gBAAN,GAAyB;AACrB,cAAMC,SAASC,eAAKC,OAAL,GACVC,KADU,CACJ,UADI,EAEVC,MAFU,CAEH,OAFG,CAAf;AAGA,YAAIJ,MAAJ,EAAY;AACRK,oBAAQC,GAAR,CAAY,oCAAZ,EADQ,CAC0C;AAClD,kBAAMN,OAAOO,MAAP,EAAN;AACH;;AAED,cAAMC,QAAQ,IAAIP,cAAJ,CAAS;AACnBQ,sBAAU,OADS;AAEnBC,sBAAU,OAFS;AAGnBC,kBAAM;AACFC,0BAAU;AADR,aAHa;AAMnBC,mBAAO,CAAC,OAAD;AANY,SAAT,CAAd;AAQA,cAAMC,SAAS,MAAMN,MAAMO,IAAN,EAArB;AACA,cAAM,uBAAU,YAAV,EAAwBD,OAAOL,QAA/B,CAAN;;AAEAJ,gBAAQC,GAAR,CAAa,kCAAb,EApBqB,CAoB2B;AACnD,KAtBkB;AAuBnB,UAAMU,oBAAN,GAA6B;AACzBX,gBAAQC,GAAR,CAAY,mCAAZ,EADyB,CACwB;AACjD,cAAMW,kBAAkB,MAAMC,wBAAchB,OAAd,GACzBC,KADyB,CACnB,KADmB,EAEzBC,MAFyB,CAElB,IAFkB,EAGzBe,KAHyB,EAA9B;AAIA,YAAIF,mBAAmB,CAAvB,EAA0B;AACtB,kBAAMG,OAAO,IAAIF,uBAAJ,CAAkB;AAC3BG,qBAAK,IADsB;AAE3BC,uBAAO,CAAC;AAFmB,aAAlB,CAAb;AAIA,kBAAMF,KAAKL,IAAL,EAAN;AACH;AACD,cAAMQ,qBAAqB,MAAML,wBAAchB,OAAd,GAC5BC,KAD4B,CACtB,KADsB,EAE5BC,MAF4B,CAErB,IAFqB,EAG5Be,KAH4B,EAAjC;AAIA,YAAII,sBAAsB,CAA1B,EAA6B;AACzB,kBAAMC,UAAU,IAAIN,uBAAJ,CAAkB;AAC9BG,qBAAK,IADyB;AAE9BC,uBAAO,CAAC;AAFsB,aAAlB,CAAhB;AAIA,kBAAME,QAAQT,IAAR,EAAN;AACH;AACJ,KA/CkB;AAgDnB,UAAMU,UAAN,GAAmB;AACf,cAAMC,eAAe,EAAE,MAAM,8BAAR,CAArB;AACA,YAAIA,YAAJ,EAAkB;AACdrB,oBAAQC,GAAR,CAAY,0BAAZ,EADc,CAC0B;AACxC,kBAAMR,eAAeC,gBAAf,EAAN;;AAEA,kBAAM,gCAAN;AACH;AACD,cAAMD,eAAekB,oBAAf,EAAN;AACA,cAAMW,eAAKC,SAAL,EAAN;AACH;AA1DkB,CAAvB;;AA6DAC,OAAOC,OAAP,CAAeC,OAAf,GAAyBjC,cAAzB;AACA+B,OAAOC,OAAP,GAAiBhC,cAAjB","file":"initialization.js","sourcesContent":["import { configAvailable, setConfig, setDefaultConfigs } from '../utils/config'\nimport User from '../models/User'\nimport PenaltyConfig from '../models/Penalty/PenaltyConfig'\nimport role from '../utils/role'\n\nconst initialization = {\n    async createSuperAdmin() {\n        const exists = User.findOne()\n            .where('username')\n            .equals('admin')\n        if (exists) {\n            console.log('Removing existing admin account...') // eslint-disable-line no-console\n            await exists.remove()\n        }\n\n        const admin = new User({\n            username: 'admin',\n            password: 'admin',\n            info: {\n                realname: '관리자',\n            },\n            roles: ['admin'],\n        })\n        const result = await admin.save()\n        await setConfig('superAdmin', result.username)\n\n        console.log(`Superadmin created (admin/admin)`) // eslint-disable-line no-console\n    },\n    async createDefaultPenalty() {\n        console.log('Creating defalut penalty items...') // eslint-disable-line no-console\n        const existLateConfig = await PenaltyConfig.findOne()\n            .where('key')\n            .equals('지각')\n            .count()\n        if (existLateConfig == 0) {\n            const Late = new PenaltyConfig({\n                key: '지각',\n                value: -1,\n            })\n            await Late.save()\n        }\n        const existAbsenceConfig = await PenaltyConfig.findOne()\n            .where('key')\n            .equals('결석')\n            .count()\n        if (existAbsenceConfig == 0) {\n            const Absence = new PenaltyConfig({\n                key: '결석',\n                value: -1,\n            })\n            await Absence.save()\n        }\n    },\n    async initialize() {\n        const isFirstStart = !(await configAvailable())\n        if (isFirstStart) {\n            console.log('Initialization detected.') // eslint-disable-line no-console\n            await initialization.createSuperAdmin()\n\n            await setDefaultConfigs()\n        }\n        await initialization.createDefaultPenalty()\n        await role.loadRoles()\n    },\n}\n\nmodule.exports.default = initialization\nmodule.exports = initialization"]}